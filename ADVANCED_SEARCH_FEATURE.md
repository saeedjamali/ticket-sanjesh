# قابلیت جستجوی پیشرفته پرسنل - Advanced Personnel Search Feature

## خلاصه

این قابلیت امکان جستجوی جامع و پیشرفته پرسنل را برای کارشناسان استان (`provinceTransferExpert`) فراهم می‌کند.

## ویژگی‌های کلیدی

### 1. جستجو بر اساس:

- کد ملی (National ID)
- کد پرسنلی (Personnel Code)

### 2. اطلاعات نمایش داده شده:

#### اطلاعات اصلی پرسنل (TransferApplicantSpec)

- مشخصات فردی (نام، کد ملی، کد پرسنلی، جنسیت)
- اطلاعات شغلی (رشته، سنوات، امتیاز، منطقه خدمت)
- وضعیت فعلی درخواست

#### اطلاعات رتبه‌بندی

- رتبه فرد در گروه رشته و جنسیت
- کل تعداد واجدین شرایط
- در نظر گیری فیلد `isShared` از جدول `EmploymentField`
- محاسبه بر اساس منطقه خدمت فعلی

#### درخواست‌های تجدید نظر (AppealRequest)

- لیست کامل درخواست‌های تجدید نظر
- دلایل انتخاب شده و وضعیت بررسی هر دلیل
- اطلاعات گفتگو و پیام‌ها
- وضعیت کلی بررسی

#### درخواست‌های اصلاح مشخصات (ProfileCorrectionRequest)

- تمام درخواست‌های اصلاح مشخصات
- وضعیت پردازش و پاسخ‌ها
- تاریخچه تغییرات

#### تاریخچه کامل تغییرات وضعیت

- ترکیب داده‌های `statusLog` و `requestStatusWorkflow`
- مرتب‌سازی بر اساس تاریخ
- نمایش جزئیات هر تغییر وضعیت

## فایل‌های ایجاد/تغییر یافته

### 1. API Endpoint

```
src/app/api/transfer-applicant-specs/advanced-search/route.js
```

- پردازش درخواست جستجو
- دریافت اطلاعات از چندین مدل
- محاسبه رتبه‌بندی
- کنترل دسترسی استانی

### 2. UI Component

```
src/components/AdvancedSearchModal.js
```

- رابط کاربری جستجو
- نمایش اطلاعات در sections قابل باز/بسته شدن
- فیلترهای جستجو
- نمایش نمودارها و آمار

### 3. Integration

```
src/app/dashboard/transfer-applicant-specs/page.js
```

- اضافه شدن دکمه "جستجوی پیشرفته" برای `provinceTransferExpert`
- انتگرال modal با صفحه اصلی

## نحوه استفاده

1. کاربر با نقش `provinceTransferExpert` وارد صفحه transfer-applicant-specs می‌شود
2. روی دکمه "جستجوی پیشرفته" کلیک می‌کند
3. کد ملی یا کد پرسنلی را وارد می‌کند
4. روی "جستجو" کلیک می‌کند
5. اطلاعات جامع پرسنل نمایش داده می‌شود

## محدودیت‌های دسترسی

- فقط کارشناسان استان (`provinceTransferExpert`) دسترسی دارند
- فقط پرسنل تحت پوشش استان قابل جستجو هستند
- کنترل دسترسی در سطح API و UI انجام شده

## امکانات فنی

### محاسبه رتبه‌بندی

- استفاده از aggregation برای کارایی بهتر
- در نظر گیری فیلد `isShared` برای رشته‌های مشترک
- فیلتر بر اساس وضعیت‌های معتبر درخواست

### عملکرد

- بهینه‌سازی queries برای کاهش زمان پاسخ
- استفاده از lean() برای بهبود performance
- محدود کردن داده‌های برگشتی به موارد ضروری

### امنیت

- احراز هویت کامل
- کنترل دسترسی نقش‌محور
- اعتبارسنجی ورودی‌ها

## API Response Structure

```json
{
  "success": true,
  "data": {
    "transferSpec": {
      /* اطلاعات اصلی پرسنل */
    },
    "appealRequests": [
      /* درخواست‌های تجدید نظر */
    ],
    "profileCorrectionRequests": [
      /* درخواست‌های اصلاح */
    ],
    "rankingInfo": {
      /* اطلاعات رتبه‌بندی */
    },
    "statusHistory": {
      /* تاریخچه تغییرات */
    },
    "summary": {
      /* آمار کلی */
    }
  }
}
```

## نکات پیاده‌سازی

1. **Responsive Design**: رابط کاربری برای تمام اندازه‌های صفحه بهینه شده
2. **Loading States**: نمایش وضعیت بارگذاری در تمام مراحل
3. **Error Handling**: مدیریت خطاها و نمایش پیام‌های مناسب
4. **Accessibility**: پشتیبانی از accessibility guidelines
5. **RTL Support**: پشتیبانی کامل از راست به چپ

## تست و اعتبارسنجی

- تست با نقش‌های مختلف کاربری
- اعتبارسنجی محدودیت‌های دسترسی
- تست عملکرد با حجم داده بالا
- تست responsive design

---

ایجاد شده در: ${new Date().toLocaleDateString('fa-IR')}
نسخه: 1.0.0
